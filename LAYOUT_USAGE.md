# Using Marp with Astro Layouts

As of version 0.2.0, astro-marp now supports injecting Marp slide content into Astro layouts! This allows you to add custom headers, footers, navigation, and other UI elements around your presentations.

## Quick Start

### Method 1: Using Slides Component (Recommended)

Create a layout for your presentations:

```astro
---
// src/layouts/PresentationLayout.astro
import { MarpStyles } from '../content/presentations/example.marp';

const { frontmatter } = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{frontmatter.title || 'Presentation'}</title>

    <!-- Inject Marp styles and SVG definitions -->
    <MarpStyles />

    <!-- Add your custom styles -->
    <style>
        .presentation-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 1rem;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <!-- Custom header -->
    <div class="presentation-header">
        <h1>{frontmatter.title}</h1>
        <p>Use arrow keys to navigate</p>
    </div>

    <!-- Inject Marp slides -->
    <slot />
</body>
</html>
```

Use the layout in your presentation page:

```astro
---
// src/pages/presentations/[...slug].astro
import { getCollection } from 'astro:content';
import PresentationLayout from '../../layouts/PresentationLayout.astro';

export async function getStaticPaths() {
  const presentations = await getCollection('presentation');
  return presentations.map((presentation) => ({
    params: { slug: presentation.slug },
    props: { presentation },
  }));
}

const { presentation } = Astro.props;
const { Slides } = await presentation.render();
---

<PresentationLayout frontmatter={presentation.data}>
    <Slides />
</PresentationLayout>
```

### Method 2: Direct .marp File Pages

You can also use layouts directly in .marp files placed in `src/pages/`:

```markdown
---
# src/pages/my-talk.marp
title: My Amazing Talk
theme: am_blue
layout: ../layouts/PresentationLayout.astro
---

# Slide 1

Content here...

---

# Slide 2

More content...
```

The layout specified in frontmatter will automatically wrap your slides!

## Available Components

When you render a `.marp` file, you get access to these components:

### `Slides`
Renders only the slide content (`<section>` elements) without any HTML wrapper.

```astro
const { Slides } = await presentation.render();
---
<Slides />
```

### `MarpStyles`
Injects Marp-generated styles and SVG definitions into your `<head>`.

```astro
import { MarpStyles } from '../content/presentations/example.marp';
---
<head>
    <MarpStyles />
</head>
```

### `Content` (Legacy)
Renders the complete HTML page generated by Marp CLI. Use this for backward compatibility.

```astro
const { Content } = await presentation.render();
---
<Content />
```

## Available Functions

The .marp module exports several helper functions:

```astro
---
import presentation from '../content/presentations/example.marp';

// Get raw slide HTML
const slidesHtml = presentation.getSlides();

// Get Marp-generated CSS
const styles = presentation.getStyles();

// Get SVG definitions (for backgrounds, etc.)
const svgDefs = presentation.getSvgDefs();

// Get complete HTML (legacy)
const fullHtml = presentation.compiledContent();

// Get frontmatter data
const frontmatter = presentation.frontmatter;
---
```

## Examples

### Example 1: Adding Custom Navigation

```astro
---
// src/layouts/PresentationWithNav.astro
const { frontmatter } = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{frontmatter.title}</title>
    <MarpStyles />
    <style>
        .nav-buttons {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1000;
        }
        .nav-buttons button {
            padding: 1rem;
            margin: 0.5rem;
            font-size: 1.5rem;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <slot />

    <div class="nav-buttons">
        <button onclick="history.back()">‚Üê Back</button>
        <button onclick="window.print()">üñ®Ô∏è Print</button>
    </div>
</body>
</html>
```

### Example 2: Adding Analytics

```astro
---
// src/layouts/PresentationWithAnalytics.astro
const { frontmatter } = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{frontmatter.title}</title>
    <MarpStyles />

    <!-- Add analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_ID');
    </script>
</head>
<body>
    <slot />
</body>
</html>
```

### Example 3: Integration with Tailwind CSS

Now you can use Tailwind CSS with your presentations!

```astro
---
// src/layouts/TailwindPresentation.astro
const { frontmatter } = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{frontmatter.title}</title>

    <!-- Inject Marp styles -->
    <MarpStyles />

    <!-- Add Tailwind (won't conflict anymore!) -->
    <link rel="stylesheet" href="/styles/tailwind.css">
</head>
<body class="bg-gray-100">
    <!-- Custom Tailwind UI -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <h1 class="text-2xl font-bold text-gray-800">{frontmatter.title}</h1>
        </div>
    </nav>

    <!-- Marp slides -->
    <main class="container mx-auto mt-4">
        <slot />
    </main>
</body>
</html>
```

## Migration Guide

### From Full HTML to Layout-Based

**Before (Full HTML - still works!):**
```astro
---
const { Content } = await presentation.render();
---
<Content />
```

**After (With Layout):**
```astro
---
import PresentationLayout from '../../layouts/PresentationLayout.astro';
const { Slides } = await presentation.render();
---
<PresentationLayout frontmatter={presentation.data}>
    <Slides />
</PresentationLayout>
```

## Technical Details

### How It Works

1. **Marp CLI Output**: The Marp CLI generates a complete HTML document with embedded styles
2. **HTML Parsing**: astro-marp parses this document and extracts:
   - Slide content (all `<section>` elements)
   - Embedded styles (from `<style>` tags)
   - SVG definitions (for backgrounds and graphics)
3. **Component Generation**: Three components are created:
   - `Slides`: Just the slide content
   - `MarpStyles`: Just the styles and SVG defs
   - `Content`: Complete HTML (backward compatible)

### Browser Compatibility

The `Slides` component generates the same HTML structure that Marp uses:

```html
<div id="marp" class="marpit">
    <section>Slide 1 content</section>
    <section>Slide 2 content</section>
    <!-- ... -->
</div>
```

This ensures full compatibility with:
- Marp's built-in navigation (arrow keys)
- Marp's responsive behavior
- Custom Marp directives (backgrounds, filters, etc.)

## Best Practices

1. **Always include `<MarpStyles />`**: Without Marp's styles, slides won't render correctly
2. **Preserve Marp's navigation**: Don't interfere with keyboard event handlers
3. **Use fixed positioning carefully**: Marp slides are full-screen by default
4. **Test responsive behavior**: Marp presentations adapt to different screen sizes

## Troubleshooting

### Slides render without styles
Make sure you're including `<MarpStyles />` in your layout's `<head>` section.

### Keyboard navigation doesn't work
Ensure you're not preventing keyboard events in your custom layout JavaScript.

### Images don't load
Image optimization works the same way - local images are automatically processed by Astro's pipeline.

## What's Next?

- Add custom themes that work with layouts
- Create presenter mode layouts
- Build slide overview/thumbnail views
- Add custom slide transitions

Enjoy building amazing presentations with Astro and Marp! üéâ
